var u=Object.defineProperty;var p=(a,t,e)=>t in a?u(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var h=(a,t,e)=>(p(a,typeof t!="symbol"?t+"":t,e),e);const g=class g{static debounce(t,e){let s;return(...i)=>{const l=this,r=()=>{s=void 0,t.apply(l,i)};clearTimeout(s),s=window.setTimeout(r,e)}}static getMargin(t,e){const s=window.getComputedStyle(e);return parseFloat(s[`margin${t}`])||0}static toPx(t){return`${t}px`}static getTop(t){return parseFloat(t.style.top)}static getLeft(t){return parseFloat(t.style.left)}static getClientWidth(t){return t.clientWidth}static getClientHeight(t){return t.clientHeight}static getBottom(t){return this.getTop(t)+this.getClientHeight(t)+this.getMargin("Bottom",t)}static getRight(t){return this.getLeft(t)+this.getClientWidth(t)+this.getMargin("Right",t)}static sortElements(t){t.sort((e,s)=>this.getBottom(e)===this.getBottom(s)?this.getLeft(s)-this.getLeft(e):this.getBottom(s)-this.getBottom(e))}static applyLayout(t){typeof t=="string"&&(t=document.querySelector(t));const e=[].map.call(t.children,o=>(o.style.position="absolute",o));t.style.position="relative";let s=[];e.length&&(e[0].style.top="0px",e[0].style.left=this.toPx(this.getMargin("Left",e[0])),s.push(e[0]));let i;for(i=1;i<e.length;i++){const o=e[i-1],n=e[i];if(!(this.getRight(o)+this.getClientWidth(n)<=this.getClientWidth(t)))break;n.style.top=o.style.top,n.style.left=this.toPx(this.getRight(o)+this.getMargin("Left",n)),s.push(n)}for(;i<e.length;i++){this.sortElements(s);const o=e[i],n=s.pop();o.style.top=this.toPx(this.getBottom(n)+this.getMargin("Top",o)),o.style.left=this.toPx(this.getLeft(n)),s.push(o)}this.sortElements(s);const l=s[0];t.style.height=this.toPx(this.getBottom(l)+this.getMargin("Bottom",l));const r=this.getClientWidth(t);window.addEventListener?window.addEventListener("resize",this.resizeListener(t,r)):document.body.onresize=this.resizeListener(t,r)}static async loadNextPage(t){var o,n;if(this.isLoading)return;if(this.currentPage>this.totalPage){(o=document.querySelector(".loading"))==null||o.remove();return}this.isLoading=!0;const s=await(await fetch(`/photos/page/${this.currentPage}`)).text();new DOMParser().parseFromString(s,"text/html").querySelectorAll(".gallery-photo").forEach(d=>t.appendChild(d)),this.initLazyLoadAndLayout(t),this.currentPage++,this.currentPage>this.totalPage&&((n=document.querySelector(".loading"))==null||n.remove()),this.isLoading=!1}static initLazyLoadAndLayout(t){typeof t=="string"&&(t=document.querySelector(t));const e=t.querySelectorAll("img[data-src]"),s=new IntersectionObserver(i=>{i.forEach(l=>{if(l.isIntersecting){const r=l.target;r.src=r.getAttribute("data-src"),r.removeAttribute("data-src"),r.parentElement.classList.add("visible"),s.unobserve(r),r.onload=this.debounce(()=>this.applyLayout(t),100)}})},{rootMargin:"50px 0px",threshold:.5});e.forEach(i=>s.observe(i))}static initInfiniteScroll(t){new IntersectionObserver(s=>{s[0].isIntersecting&&this.loadNextPage(document.querySelector(t))},{threshold:1}).observe(document.querySelector(".loading"))}};h(g,"currentPage",Number(document.querySelector(".gallery-photos").getAttribute("data-page")||1)+1),h(g,"isLoading",!1),h(g,"totalPage",Number(document.querySelector(".gallery-photos").getAttribute("data-total-page"))||1),h(g,"resizeListener",(t,e)=>function(s){this.clientWidth!==e&&(s.target.removeEventListener(s.type,arguments.callee),g.applyLayout(t))});let c=g;window.addEventListener("load",()=>{const a=".gallery-photos";c.initLazyLoadAndLayout(a),c.initInfiniteScroll(a)});
