var h=Object.defineProperty;var u=(s,t,e)=>t in s?h(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(u(s,typeof t!="symbol"?t+"":t,e),e);const d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","…":"&hellip;"};function p(s){return d[s]||s}class c{constructor({form:t,input:e,list:i,resultTitle:r,resultTitleTemplate:n}){a(this,"form");a(this,"input");a(this,"list");a(this,"resultTitle");a(this,"resultTitleTemplate");this.form=t,this.input=e,this.list=i,this.resultTitle=r,this.resultTitleTemplate=n,this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}async searchKeywords(t){let e=[],i=0,r=t.join("");r=r.replace(/[&<>"…]/g,p);try{const n=`/apis/api.halo.run/v1alpha1/indices/post?keyword=${r}&highlightPreTag=%3Cmark%3E&highlightPostTag=%3C/mark%3E`,o=await(await fetch(n)).json();return e=o.hits,i=o.processingTimeMillis,{results:e,processingTimeMillis:i}}catch(n){return console.warn(n),null}}async doSearch(t){const e=await this.searchKeywords(t);this.clear();const i=e==null?void 0:e.results;for(const r of i)this.list.append(c.render(r));this.resultTitle.innerText=this.generateResultTitle(i==null?void 0:i.length,((e==null?void 0:e.processingTimeMillis)/1e3).toPrecision(1))}generateResultTitle(t,e){return this.resultTitleTemplate.replace("#PAGES_COUNT",t).replace("#TIME_SECONDS",e)}bindSearchForm(){let t="";const e=i=>{i.preventDefault();const r=this.input.value.trim();if(c.updateQueryString(r,!0),r==="")return t="",this.clear();t!==r&&(t=r,this.doSearch(r.split(" ")))};this.input.addEventListener("input",e),this.input.addEventListener("compositionend",e)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",()=>{this.handleQueryString()})}handleQueryString(){const e=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=e,e?this.doSearch(e.split(" ")):this.clear()}static updateQueryString(t,e=!1){const i=new URL(window.location.toString());t===""?i.searchParams.delete("keyword"):i.searchParams.set("keyword",t),e?window.history.replaceState("","",i.toString()):window.history.pushState("","",i.toString())}static render(t){const e=document.createElement("article"),i=document.createElement("a");i.href=t.permalink;const r=document.createElement("div");r.className="article-details";const n=document.createElement("h2");n.className="article-title",n.innerHTML=t.title;const l=document.createElement("section");return l.className="article-preview",l.innerHTML=t.description||"",r.appendChild(n),r.appendChild(l),i.appendChild(r),e.appendChild(i),e}}window.addEventListener("load",()=>{setTimeout(function(){const s=document.querySelector(".search-form"),t=s.querySelector("input"),e=document.querySelector(".search-result--list"),i=document.querySelector(".search-result--title");new c({form:s,input:t,list:e,resultTitle:i,resultTitleTemplate:window.searchResultTitleTemplate})},0)});
